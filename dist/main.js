(()=>{const e=document.getElementById("addItemForm"),t=document.getElementById("itemNameInput"),n=document.getElementById("categoryInput"),o=document.getElementById("inventoryList"),c=document.getElementById("totalCount"),a=document.getElementById("exportBtn"),s=document.getElementById("searchInput"),d=document.getElementById("feedback"),m=document.getElementById("toggleTheme");let r=JSON.parse(localStorage.getItem("inventory"))||[],l=null;function i(){localStorage.setItem("inventory",JSON.stringify(r))}function u(e,t="#4CAF50"){d.textContent=e,d.style.color=t,d.classList.add("show"),setTimeout((()=>d.classList.remove("show")),2500)}function g(e=r){o.innerHTML="";const t=e.reduce(((e,t,n)=>(e[t.category]||(e[t.category]=[]),e[t.category].push({...t,index:n}),e)),{});Object.keys(t).forEach((e=>{const n=document.createElement("div");n.className="category-section";const c=document.createElement("div");c.className="category-header",c.textContent=e;const a=document.createElement("div");a.className="item-list",t[e].forEach((({name:t,count:n,index:o})=>{const c=document.createElement("div");c.className="item",n<=0&&c.classList.add("low-stock"),c.setAttribute("draggable","true"),c.dataset.index=o,c.addEventListener("dragstart",(()=>l=o)),c.addEventListener("dragover",(e=>e.preventDefault())),c.addEventListener("drop",(e=>{const t=+c.dataset.index;if(null!==l&&t!==l){const e=r[l];r.splice(l,1),r.splice(t,0,e),i(),g()}l=null}));const s=document.createElement("span");s.textContent=t;const d=document.createElement("div");d.className="controls";const m=document.createElement("button");m.textContent="✏️",m.className="btn editName",m.onclick=()=>{const e=prompt("Edit item name:",t);e&&(r[o].name=e.trim(),i(),g(),u("Name updated"))};const p=document.createElement("button");p.textContent="📁",p.className="btn editCat",p.onclick=()=>{const t=prompt("Change category:",e);t&&t.trim()&&(r[o].category=t.trim(),i(),g(),u("Category changed"))};const y=document.createElement("button");y.textContent="–",y.className="btn dec",y.onclick=()=>{r[o].count>0?(r[o].count--,i(),g()):u("Count can't go below 0","red")};const E=document.createElement("span");E.className="count",E.textContent=n;const C=document.createElement("button");C.textContent="+",C.className="btn inc",C.onclick=()=>{r[o].count++,i(),g()};const b=document.createElement("button");b.textContent="Reset",b.className="btn reset",b.onclick=()=>{r[o].count=0,i(),g()};const v=document.createElement("button");v.textContent="🗑️",v.className="btn del",v.onclick=()=>{r.splice(o,1),i(),g()},d.append(m,p,y,E,C,b,v),c.append(s,d),a.appendChild(c)})),n.append(c,a),o.appendChild(n)})),function(){const e=r.reduce(((e,t)=>e+t.count),0);c.textContent=`Total Items: ${e}`}()}e.onsubmit=o=>{o.preventDefault();const c=t.value.trim(),a=n.value;if(c&&a)return r.some((e=>e.name.toLowerCase()===c.toLowerCase()&&e.category===a))?u("Item already exists","red"):(r.push({name:c,category:a,count:0}),i(),g(),e.reset(),void u("Item added"))},s.oninput=()=>{const e=s.value.trim().toLowerCase();g(r.filter((t=>t.name.toLowerCase().includes(e)||t.category.toLowerCase().includes(e))))},a.onclick=()=>{let e="Item Name,Category,Count\n";r.forEach((t=>e+=`${t.name},${t.category},${t.count}\n`));const t=new Blob([e],{type:"text/csv"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="inventory.csv",n.click()},document.getElementById("importCSV").addEventListener("change",(e=>{const t=new FileReader;t.onload=e=>{const t=e.target.result.split("\n").slice(1);let n=0;t.forEach((e=>{const[t,o,c]=e.split(",");t&&o&&!r.find((e=>e.name===t&&e.category===o))&&(r.push({name:t.trim(),category:o.trim(),count:parseInt(c)||0}),n++)})),i(),g(),u(`${n} items imported`)},t.readAsText(e.target.files[0])})),"dark"===localStorage.getItem("theme")&&document.body.classList.add("dark"),m.onclick=()=>{document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")},g()})();